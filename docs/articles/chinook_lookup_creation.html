<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chinook lookup creation • framr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Chinook lookup creation">
<meta property="og:description" content="framr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">framr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/chinook_lookup_creation.html">Chinook lookup creation</a>
    </li>
    <li>
      <a href="../articles/chinook_post_processing.html">Chinook FRAM Post-processing</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/FRAMverse/framr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Chinook lookup creation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FRAMverse/framr/blob/HEAD/vignettes/chinook_lookup_creation.Rmd" class="external-link"><code>vignettes/chinook_lookup_creation.Rmd</code></a></small>
      <div class="hidden name"><code>chinook_lookup_creation.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates the construction of lookup tables that are available as <code>framr::chin_stock_lu</code> and <code>framr::chin_fishery_lu</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/FRAMverse/framr" class="external-link">framr</a></span><span class="op">)</span></code></pre></div>
<div class="section level1">
<h1 id="lu_chin_stock">lu_chin_stock<a class="anchor" aria-label="anchor" href="#lu_chin_stock"></a>
</h1>
<p>The following is modified from *chin_valid_2020.Rmd”.</p>
<p>The “BackwardsFRAM” table includes 116 BKFRAM stocks which are indexed differently than for forward FRAM due to the inclusion of “totals” over marked and unmarked components. However, the project database tables do not currently include a lookup that cross-references the BKFRAM ids to those in the (forward) “Stock” table, so it was necessary to read and clean information in the “FRAMEscapeV2” sheet of an older FRAM stock compilation Excel workbook.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#grab current forward stock IDs and names</span>
<span class="va">db_con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span>
  drv <span class="op">=</span> <span class="fu">odbc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/odbc/man/odbc.html" class="external-link">odbc</a></span><span class="op">(</span><span class="op">)</span>,
  .connection_string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
    <span class="st">"Driver={Microsoft Access Driver (*.mdb, *.accdb)};DBQ="</span>,
    <span class="st">"O:/valid_2020/r711/Valid2020_Round_7.1.1.mdb"</span>, <span class="co">#"O:/code/chin_fram_validation_r62_1992_2016/Valid2018_NewBP_Round6_10.29.2018_Complete_cmpct.mdb",</span>
    <span class="st">";"</span><span class="op">)</span><span class="op">)</span>

<span class="va">db_stock</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">db_con</span>, <span class="st">"Stock"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"Chinook"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">StockID</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span>
  
<span class="co">#not used: db_bkfram &lt;- tbl(db_con, "BackwardsFRAM") |&gt; collect() |&gt; rename(bkfram_id = StockID)</span>

<span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">db_con</span><span class="op">)</span>


<span class="co">#Note WhiteSp are 65/66, but Valid2018 sheet FRAMEscapeV2 incorrectly has ORMidCoastFalls Stock# colK assigned this rather than 77/78</span>
<span class="va">framescapev2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span>
  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"O:/valid_2020/Valid2018/Valid2018_FRAM_StockData_10.30.2018.xlsm"</span>,
                     range <span class="op">=</span> <span class="st">"FRAMEscapeV2!A2:B117"</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stock_name"</span>, <span class="st">"stock_abbr"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"O:/valid_2020/Valid2018/Valid2018_FRAM_StockData_10.30.2018.xlsm"</span>,
                     range <span class="op">=</span> <span class="st">"FRAMEscapeV2!K2:L117"</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stock_id"</span>, <span class="st">"bkfram_id"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    <span class="co">#fix the ORMidCoast misassignment</span>
    stock_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">bkfram_id</span> <span class="op">==</span> <span class="fl">115</span>, <span class="fl">77</span>, <span class="va">stock_id</span><span class="op">)</span>,
    stock_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">bkfram_id</span> <span class="op">==</span> <span class="fl">116</span>, <span class="fl">78</span>, <span class="va">stock_id</span><span class="op">)</span>,
    <span class="co">#also differs from the "Stock" abbreviation</span>
    stock_abbr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">bkfram_id</span> <span class="op">==</span> <span class="fl">115</span>, <span class="st">"U-MidORCst"</span>, <span class="va">stock_abbr</span><span class="op">)</span>,
    stock_abbr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">bkfram_id</span> <span class="op">==</span> <span class="fl">116</span>, <span class="st">"M-MidORCst"</span>, <span class="va">stock_abbr</span><span class="op">)</span>,
    <span class="co">#and the WhiteSp have the wrong strings</span>
    stock_name <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">bkfram_id</span> <span class="op">==</span> <span class="fl">55</span>, <span class="st">"UnMarked White Sp Year"</span>, <span class="va">stock_name</span><span class="op">)</span>,
    stock_name <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">bkfram_id</span> <span class="op">==</span> <span class="fl">56</span>, <span class="st">"Marked White Sp Year"</span>, <span class="va">stock_name</span><span class="op">)</span>,
    <span class="co">#mapping bkframids to per-stock totals </span>
    bkfram_id_tot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">115</span>, by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,
    <span class="co">#cleanup</span>
    stock_name <span class="op">=</span> <span class="va">stock_name</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">"-----"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="op">)</span>,
    stock_abbr <span class="op">=</span> <span class="va">stock_abbr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">"--"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="op">)</span>,
    bk_run_def <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span> <span class="op">~</span> <span class="st">"TRS; includes 7B-D"</span>, <span class="co">#Nook/Sam</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">9</span><span class="op">:</span><span class="fl">17</span> <span class="op">~</span> <span class="st">"TRS; includes Area 8 Net"</span>, <span class="co">#Skag</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">18</span><span class="op">:</span><span class="fl">23</span> <span class="op">~</span> <span class="st">"ETRS; includes FW sport, no FW net"</span>, <span class="co">#Sno</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">24</span><span class="op">:</span><span class="fl">26</span> <span class="op">~</span> <span class="st">"ETRS"</span>, <span class="co">#Stilly FF</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">27</span><span class="op">:</span><span class="fl">29</span> <span class="op">~</span> <span class="st">"TRS; includes 8D catch (excludes 8A)"</span>, <span class="co">#Tulalip FF</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">30</span><span class="op">:</span><span class="fl">32</span> <span class="op">~</span> <span class="st">"TRS; includes 10A, 10E, 11A"</span>, <span class="co">#Mid PS FF</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">33</span><span class="op">:</span><span class="fl">35</span> <span class="op">~</span> <span class="st">"ETRS"</span>, <span class="co">#UW Accel</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">36</span><span class="op">:</span><span class="fl">38</span> <span class="op">~</span> <span class="st">"TRS; includes 13A, 13C, and 13D-K"</span>, <span class="co">#SPS FF</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">39</span><span class="op">:</span><span class="fl">41</span> <span class="op">~</span> <span class="st">"TRS"</span>, <span class="co">#SPS FY</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">42</span><span class="op">:</span><span class="fl">44</span> <span class="op">~</span> <span class="st">"ETRS; includes FW net (FW spt assumed 0)"</span>, <span class="co">#White Spr F</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">45</span><span class="op">:</span><span class="fl">50</span> <span class="op">~</span> <span class="st">"TRS; incl FW net, FW sport, 12H, HC net"</span>, <span class="co">#HC FF/FY</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">51</span><span class="op">:</span><span class="fl">53</span> <span class="op">~</span> <span class="st">"ETRS; includes 6D"</span>, <span class="co">#JDF F</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">54</span><span class="op">:</span><span class="fl">56</span> <span class="op">~</span> <span class="st">"ETRS; includes FW net (FW spt assumed 0)"</span>, <span class="co">#White Spr Y</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">57</span><span class="op">:</span><span class="fl">59</span> <span class="op">~</span> <span class="st">"ETRS; esc only, no FW fishery"</span> <span class="co">#Hoko</span>
      <span class="op">)</span>,
    <span class="co">#matching the levels in tamm_regions</span>
    region <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span> <span class="op">~</span> <span class="st">"NookSam"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">9</span><span class="op">:</span><span class="fl">17</span> <span class="op">~</span> <span class="st">"Skagit"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">18</span><span class="op">:</span><span class="fl">29</span> <span class="op">~</span> <span class="st">"StSno"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span><span class="op">:</span><span class="fl">35</span>, <span class="fl">42</span><span class="op">:</span><span class="fl">44</span>, <span class="fl">54</span><span class="op">:</span><span class="fl">56</span><span class="op">)</span> <span class="op">~</span> <span class="st">"MPS"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">36</span><span class="op">:</span><span class="fl">41</span> <span class="op">~</span> <span class="st">"SPS"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">45</span><span class="op">:</span><span class="fl">50</span> <span class="op">~</span> <span class="st">"HC"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">51</span><span class="op">:</span><span class="fl">53</span>, <span class="fl">57</span><span class="op">:</span><span class="fl">59</span><span class="op">)</span> <span class="op">~</span> <span class="st">"JDF"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span><span class="op">:</span><span class="fl">86</span>, <span class="fl">102</span><span class="op">:</span><span class="fl">104</span><span class="op">)</span> <span class="op">~</span> <span class="st">"ColR"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">87</span><span class="op">:</span><span class="fl">89</span>, <span class="fl">105</span><span class="op">:</span><span class="fl">116</span><span class="op">)</span> <span class="op">~</span> <span class="st">"WA_NCoast_OR_CA"</span>,
      <span class="va">bkfram_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span><span class="op">:</span><span class="fl">101</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Canada"</span>
      <span class="op">)</span>
  <span class="op">)</span>

<span class="va">lu_chin_stock</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span>
  <span class="va">db_stock</span>,
  <span class="va">framescapev2</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>StockID <span class="op">=</span> <span class="va">stock_id</span>, <span class="va">bkfram_id</span><span class="op">:</span><span class="va">region</span><span class="op">)</span>,
  by <span class="op">=</span> <span class="st">"StockID"</span>
  <span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">bkfram_id</span><span class="op">)</span>

<span class="co">#modified existing/prior description in "R/data-chin_stock_lu.R"</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">lu_chin_stock</span>, file <span class="op">=</span> <span class="st">"data/lu_chin_stock.rda"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="lu_chin_fishery">lu_chin_fishery<a class="anchor" aria-label="anchor" href="#lu_chin_fishery"></a>
</h1>
<p>The following reads a <code>Fishery</code> table from a current Chinook project database and appends several fields of metadata and catch database identifiers. Note that additional TAMM fisheries are required for a complete depiction of impacts (i.e., including terminal and freshwater mortality).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">db_con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span>
  drv <span class="op">=</span> <span class="fu">odbc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/odbc/man/odbc.html" class="external-link">odbc</a></span><span class="op">(</span><span class="op">)</span>,
  .connection_string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
    <span class="st">"Driver={Microsoft Access Driver (*.mdb, *.accdb)};DBQ="</span>,
    <span class="st">"O:/valid_2020/r711/Valid2020_Round_7.1.1.mdb"</span>,
    <span class="st">";"</span><span class="op">)</span><span class="op">)</span>

<span class="va">db_fishery</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">db_con</span>, <span class="st">"Fishery"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"CHINOOK"</span><span class="op">)</span> |&gt;  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">FisheryID</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span>
  
<span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">db_con</span><span class="op">)</span>

<span class="va">lu_chin_fishery</span> <span class="op">&lt;-</span> <span class="va">db_fishery</span> |&gt; 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      catch_source <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
        <span class="va">FisheryID</span> <span class="op">&lt;</span> <span class="fl">16</span> <span class="op">~</span> <span class="st">"PSC/CTC"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span><span class="op">:</span><span class="fl">18</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">22</span>, <span class="fl">26</span><span class="op">:</span><span class="fl">27</span>, <span class="fl">30</span><span class="op">:</span><span class="fl">35</span><span class="op">)</span> <span class="op">~</span> <span class="st">"PFMC/STT"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,<span class="fl">42</span>,<span class="fl">45</span>,<span class="fl">48</span>,<span class="fl">53</span>,<span class="fl">54</span>,<span class="fl">56</span>,<span class="fl">57</span>,<span class="fl">60</span>,<span class="fl">62</span>,<span class="fl">64</span>,<span class="fl">67</span><span class="op">)</span> <span class="op">~</span> <span class="st">"CRC/PSSP"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23</span>,<span class="fl">24</span>,<span class="fl">25</span>, <span class="fl">37</span><span class="op">:</span><span class="fl">41</span>, <span class="fl">43</span><span class="op">:</span><span class="fl">44</span>, <span class="fl">46</span>,<span class="fl">47</span>, <span class="fl">49</span><span class="op">:</span><span class="fl">52</span>, <span class="fl">55</span>, <span class="fl">58</span>,<span class="fl">59</span>, <span class="fl">61</span>, <span class="fl">63</span>, <span class="fl">65</span>,<span class="fl">66</span>, <span class="fl">68</span><span class="op">:</span><span class="fl">71</span><span class="op">)</span> <span class="op">~</span> <span class="st">"FishTicket/TOCAS"</span>
      <span class="op">)</span>,
      region <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">37</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span>  <span class="op">~</span> <span class="st">"NookSam"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">46</span>, <span class="fl">47</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Skagit"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">49</span><span class="op">:</span><span class="fl">52</span><span class="op">)</span> <span class="op">~</span> <span class="st">"StSno"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">58</span>, <span class="fl">59</span>, <span class="fl">61</span>, <span class="fl">63</span><span class="op">)</span> <span class="op">~</span> <span class="st">"MPS"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">68</span>, <span class="fl">69</span>, <span class="fl">70</span>, <span class="fl">71</span><span class="op">)</span> <span class="op">~</span> <span class="st">"SPS"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">66</span><span class="op">)</span> <span class="op">~</span> <span class="st">"HC"</span>,
        <span class="va">FisheryID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">41</span>, <span class="fl">43</span>, <span class="fl">44</span>, <span class="fl">55</span><span class="op">)</span> <span class="op">~</span> <span class="st">"JDF"</span>
        <span class="co"># ~ "ColR",</span>
        <span class="co"># ~ "WA_NCoast_OR_CA",</span>
        <span class="co"># ~ "Canada"</span>
      <span class="op">)</span>,
      <span class="co">#CRC identifiers for marine recreational</span>
      areacode <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
        <span class="co">#FisheryID == 18 ~ "3,4", #taken from PFMC table</span>
        <span class="co">#FisheryID == 22 ~ "2", #taken from PFMC table</span>
        <span class="co">#FisheryID == 27 ~ "1", #taken from PFMC table</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">36</span> <span class="op">~</span> <span class="st">"7"</span>,
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">42</span> <span class="op">~</span> <span class="st">"5"</span>,
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">45</span> <span class="op">~</span> <span class="st">"81,82"</span>, <span class="co">#winter</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">48</span> <span class="op">~</span> <span class="st">"81,82"</span>, <span class="co">#summer, fishery 8D: area 8 is always closed in summer, so any summer catch is from 8D</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">53</span> <span class="op">~</span> <span class="st">"9"</span>,
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">54</span> <span class="op">~</span> <span class="st">"6"</span>,
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">56</span> <span class="op">~</span> <span class="st">"10"</span>,
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">57</span> <span class="op">~</span> <span class="st">"11"</span>,
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">60</span> <span class="op">~</span> <span class="cn">NA_character_</span>, <span class="co">#10A</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">62</span> <span class="op">~</span> <span class="cn">NA_character_</span>, <span class="co">#10E</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">64</span> <span class="op">~</span> <span class="st">"12"</span>,
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">67</span> <span class="op">~</span> <span class="st">"13"</span>
      <span class="op">)</span>,
      <span class="co">#WDFW FishTix identifiers for marine commercial</span>
      <span class="co">#Note that treaty catches have recently come directly from TOCAS queries by O Miler</span>
      <span class="co">#and that STT fisheries have come from PFMC STT rather than direct query of FT</span>
      CatchAreaCode <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">16</span> <span class="op">~</span> <span class="st">"03,04,04B"</span>, <span class="co">#as backup, precedence to STT tables; Area 3:4:4B Troll</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">17</span> <span class="op">~</span> <span class="st">"03,04,04B"</span>, <span class="co">#as backup, precedence to STT tables; Area 3:4:4B Troll</span>
        <span class="co">#FisheryID == 19 ~ "04A", #No Wash. Coastal Net,</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"02"</span>, <span class="co">#as backup, precedence to STT tables; Area 2 Troll</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">21</span> <span class="op">~</span> <span class="st">"02"</span>, <span class="co">#as backup, precedence to STT tables; Area 2 Troll</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">23</span> <span class="op">~</span> <span class="st">"02A,02B,02C,02D"</span>, <span class="co">#G. Harbor Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">24</span> <span class="op">~</span> <span class="st">"02A,02B,02C,02D"</span>, <span class="co">#G. Harbor Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">25</span> <span class="op">~</span> <span class="st">"02G,02H,02J,02K,02M,02N,02P,02R,02T,02U"</span>, <span class="co">#Willapa Bay Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">26</span> <span class="op">~</span> <span class="st">"01"</span>, <span class="co">#as backup, precedence to STT tables; Area 1 Troll</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"06A,07,07A"</span>, <span class="co">#6A:7:7A Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">38</span> <span class="op">~</span> <span class="st">"06A,07,07A"</span>, <span class="co">#6A:7:7A Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">39</span> <span class="op">~</span> <span class="st">"07B,07C,07D"</span>, <span class="co">#Area 7B-7D Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"07B,07C,07D"</span>, <span class="co">#Area 7B-7D Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">41</span> <span class="op">~</span> <span class="st">"05,06C"</span>, <span class="co">#Tr JDF Troll</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">43</span> <span class="op">~</span> <span class="st">"04B,05,06,06C"</span>, <span class="co">#NT JDF Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">44</span> <span class="op">~</span> <span class="st">"04B,05,06,06C"</span>, <span class="co">#TR JDF Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">46</span> <span class="op">~</span> <span class="st">"08"</span>, <span class="co">#Skagit Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">47</span> <span class="op">~</span> <span class="st">"08"</span>, <span class="co">#Skagit Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">49</span> <span class="op">~</span> <span class="st">"08A"</span>, <span class="co">#St/Snohomish Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"08A"</span>, <span class="co">#St/Snohomish Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">51</span> <span class="op">~</span> <span class="st">"08D"</span>, <span class="co">#Tulalip Bay Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">52</span> <span class="op">~</span> <span class="st">"08D"</span>, <span class="co">#Tulalip Bay Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">55</span> <span class="op">~</span> <span class="st">"06B,09"</span>, <span class="co">#Area 6B:9 Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">58</span> <span class="op">~</span> <span class="st">"10,11"</span>, <span class="co">#Area 10:11 Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">59</span> <span class="op">~</span> <span class="st">"10,11"</span>, <span class="co">#Area 10:11 Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">61</span> <span class="op">~</span> <span class="st">"10A"</span>, <span class="co">#Tr Area 10A Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">63</span> <span class="op">~</span> <span class="st">"10E"</span>, <span class="co">#Tr Area 10E Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">65</span> <span class="op">~</span> <span class="st">"12,12B,12C,12D"</span>, <span class="co">#NT Hood Canal Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">66</span> <span class="op">~</span> <span class="st">"12,12B,12C,12D"</span>, <span class="co">#Tr Hood Canal Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">68</span> <span class="op">~</span> <span class="st">"13,13B,13D,13E,13F,13G,13H,13I,13J,13K"</span>, <span class="co">#SPS Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">69</span> <span class="op">~</span> <span class="st">"13,13B,13D,13E,13F,13G,13H,13I,13J,13K"</span>, <span class="co">#SPS Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">70</span> <span class="op">~</span> <span class="st">"13A"</span>, <span class="co">#Area 13A Net</span>
        <span class="va">FisheryID</span> <span class="op">==</span> <span class="fl">71</span> <span class="op">~</span> <span class="st">"13A"</span> <span class="co">#Area 13A Net</span>
      <span class="op">)</span>,
      FisherTypeDescription <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^Tr"</span>, <span class="va">FisheryName</span><span class="op">)</span>, <span class="st">"Treaty"</span>, <span class="st">"Non-Treaty"</span><span class="op">)</span>,
      gear <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Net"</span>, <span class="va">FisheryTitle</span><span class="op">)</span>, <span class="st">"net"</span>, <span class="st">"line"</span><span class="op">)</span>
    <span class="op">)</span>



<span class="fu">use_data</span><span class="op">(</span><span class="va">lu_chin_fishery</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Dan Auerbach.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
